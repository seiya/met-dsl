# Quickstart: Nonlinear Advection Solver DSL Example

## Prerequisites
- Python 3.9+ environment with project dependencies installed (`pip install -e .[dev]`).
- Access to the Typer CLI entry point (`metdsl` command) from the repository root.
- External benchmark analysis script available at `scripts/benchmarks/cosine_bell.py` (generated by this feature).

## 1. Create the Example Specification
```bash
metdsl spec create \
  --spec-id advection-example \
  --grid 256 256 1.0 1.0 \
  --boundary periodic periodic \
  --config specs/examples/advection_periodic.yaml
```
This command registers a DSL specification with Arakawa-C staggering, dual periodic boundaries, second-order nonlinear advection/diffusion stencils, explicit RK4 stages, and validation hooks.

## 2. Generate Solver Artifacts
```bash
metdsl solver generate \
  --spec-version advection-example@latest \
  --benchmark rotating-cosine-bell \
  --output-dir runs/advection-example/run-001
```
Generation emits code, runtime configuration, NetCDF output directory scaffolding, and a JSON manifest describing produced variables.

## 3. Run the Simulation and Validation
```bash
metdsl solver run --run-id runs/advection-example/run-001
metdsl solver validate \
  --run-id runs/advection-example/run-001 \
  --analysis-script scripts/benchmarks/cosine_bell.py
```
The validation command launches the external analysis script, which reads the manifest and NetCDF outputs, and reports error metrics (target: max error ≤5%, drift ≤1%).

## 4. Clone the Specification for Variants
```bash
metdsl spec clone \
  --from-version advection-example@v0003 \
  --change "Viscosity sensitivity study" \
  --set physics.coefficient.nu=1.0e-4
```
Cloning issues a new auto-generated version identifier while preserving traceability to the parent specification.

## 5. Inspect Logs and Diagnostics
```bash
metdsl telemetry show --run-id runs/advection-example/run-001 --format json
```
Structured diagnostics include validation status, performance timings, and warnings for missing RK4 stages or unsupported boundary declarations.

## Troubleshooting
- Missing RK4 stages or stencil references trigger structured validation errors before generation.
- If required grid, physics, boundary, or timestep values are omitted, the CLI aborts with actionable guidance and emits matching telemetry events in `build/logs/`.
- If the selected timestep violates stability limits, the solver run halts with a warning detailing the recommended maximum step size.
- If the analysis script fails, rerun `metdsl solver validate` after correcting paths; the CLI reports the previous failure context.
- Ensure grid dimensions remain even (required by Arakawa-C staggering) and total steps ≤500 for compatibility with the example.
